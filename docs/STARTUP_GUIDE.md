# システム起動ガイド

## 📋 システム構成

このシステムは**シングルサーバー構成**です。他のシステムとは異なり、**フロントエンドとバックエンドを別々に起動する必要はありません**。

### アーキテクチャ

```
┌─────────────────────────────────────────┐
│   FastAPIサーバー (ポート8000)          │
│                                         │
│  ┌──────────────┐  ┌──────────────┐   │
│  │  バックエンド  │  │  フロントエンド │   │
│  │  API          │  │  静的ファイル   │   │
│  │  /api/v1/*    │  │  /static/*    │   │
│  └──────────────┘  └──────────────┘   │
│                                         │
│  ┌──────────────────────────────────┐  │
│  │  ルートエンドポイント             │  │
│  │  / → UI画面 (index.html)        │  │
│  │  /admin → 管理画面 (admin.html) │  │
│  └──────────────────────────────────┘  │
└─────────────────────────────────────────┘
              │
              │ HTTP/HTTPS
              ▼
┌─────────────────────────────────────────┐
│   Supabase (外部サービス)                │
│   - データベース                         │
│   - ストレージ                           │
└─────────────────────────────────────────┘
```

### 他のシステムとの違い

| 項目 | 一般的なシステム | このシステム |
|------|----------------|-------------|
| **フロントエンドサーバー** | 必要（React/Vue等） | **不要** |
| **バックエンドサーバー** | 必要（Express/FastAPI等） | **必要** |
| **起動コマンド数** | 2つ以上 | **1つだけ** |
| **ポート数** | 2つ以上（例: 3000, 8000） | **1つ（8000）** |
| **フロントエンド配信** | 別サーバー（例: npm start） | FastAPIが配信 |

## 🚀 起動要件

### 必須要件

1. **Python 3.10以上** がインストールされている
2. **依存関係** がインストールされている
   ```bash
   pip install -r requirements.txt
   ```
3. **Supabase設定** が完了している
   - `.env`ファイルに認証情報が設定されている
   - データベーススキーマが作成されている
4. **環境変数** が設定されている
   - `SUPABASE_URL`
   - `SUPABASE_KEY`
   - `SUPABASE_SERVICE_KEY`（推奨）

### オプション要件

- メール設定（通知機能を使用する場合）
- AI設定（レコメンデーション機能を使用する場合）

## 📝 起動手順

### Step 1: 事前確認

接続テストを実行して、Supabaseへの接続を確認：

```bash
python scripts/test_connection.py
```

すべてのテストが成功することを確認してください。

### Step 2: サーバーの起動

**1つのコマンドで起動します：**

```bash
python -m api.main
```

または

```bash
uvicorn api.main:app --reload --host 0.0.0.0 --port 8000
```

### Step 3: 動作確認

サーバーが起動したら、以下のURLにアクセス：

#### ✅ ヘルスチェック
```
http://localhost:8000/health
```
正常な場合：`{"status":"healthy"}` が返ります

#### ✅ ユーザーUI画面
```
http://localhost:8000/
```
または
```
http://localhost:8000/static/index.html
```

#### ✅ 管理画面
```
http://localhost:8000/admin
```
または
```
http://localhost:8000/static/admin.html
```

#### ✅ APIドキュメント（Swagger UI）
```
http://localhost:8000/docs
```

## 🎯 アクセス可能なURL一覧

| URL | 説明 |
|-----|------|
| `http://localhost:8000/` | ユーザーUI画面（トップページ） |
| `http://localhost:8000/admin` | 管理画面 |
| `http://localhost:8000/health` | ヘルスチェック |
| `http://localhost:8000/docs` | APIドキュメント（Swagger UI） |
| `http://localhost:8000/api/v1/*` | APIエンドポイント |
| `http://localhost:8000/static/*` | 静的ファイル（CSS/JS/画像） |

## 🔍 システムの動作確認

### 1. サーバーの状態確認

```bash
# Windows PowerShell
netstat -ano | findstr :8000

# Linux/Mac
lsof -i :8000
```

ポート8000でリッスンしていることを確認してください。

### 2. ブラウザでの確認

1. **ユーザーUI画面**にアクセス
   - サービス一覧が表示される
   - 予約フォームが動作する

2. **管理画面**にアクセス
   - 管理機能が利用できる

3. **APIドキュメント**にアクセス
   - すべてのAPIエンドポイントが表示される
   - 各エンドポイントをテストできる

### 3. ログの確認

サーバーのログは以下の場所に保存されます：

```
logs/app_YYYYMMDD.log
```

## ⚠️ よくある質問

### Q: フロントエンドサーバーを起動する必要はありますか？

**A: いいえ、必要ありません。**  
FastAPIサーバーが静的ファイル（HTML/CSS/JS）も配信するため、別のフロントエンドサーバーは不要です。

### Q: ポート3000でフロントエンドを起動する必要はありますか？

**A: いいえ、必要ありません。**  
このシステムはポート8000の1つだけで動作します。

### Q: npm start や yarn dev を実行する必要はありますか？

**A: いいえ、必要ありません。**  
フロントエンドは静的ファイルとして配信されるため、Node.jsのビルドプロセスは不要です。

### Q: 開発中にフロントエンドの変更を反映するには？

**A: 静的ファイルを編集するだけです。**  
`static/`ディレクトリ内のファイル（`index.html`, `app.js`, `style.css`など）を編集し、ブラウザをリロードしてください。  
サーバーを再起動する必要はありません（`--reload`オプション使用時）。

### Q: 本番環境での起動方法は？

**A: プロダクション用のコマンドを使用します：**

```bash
uvicorn api.main:app --host 0.0.0.0 --port 8000 --workers 4
```

または、Gunicornを使用：

```bash
gunicorn api.main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000
```

## 🛠️ トラブルシューティング

### サーバーが起動しない場合

1. **ポート8000が使用中**
   ```bash
   # 使用中のプロセスを確認
   netstat -ano | findstr :8000
   
   # プロセスを終了（必要に応じて）
   taskkill /PID <プロセスID> /F
   ```

2. **環境変数が設定されていない**
   - `.env`ファイルが存在するか確認
   - `SUPABASE_URL`と`SUPABASE_KEY`が設定されているか確認

3. **依存関係がインストールされていない**
   ```bash
   pip install -r requirements.txt
   ```

### ページが表示されない場合

1. **サーバーが起動しているか確認**
   ```bash
   curl http://localhost:8000/health
   ```

2. **ブラウザのコンソールでエラーを確認**
   - F12キーで開発者ツールを開く
   - Consoleタブでエラーを確認

3. **静的ファイルのパスを確認**
   - `static/`ディレクトリが存在するか確認
   - `index.html`が存在するか確認

## 📚 関連ドキュメント

- [セットアップチェックリスト](SETUP_CHECKLIST.md)
- [Supabase設定ガイド](SUPABASE_SETUP.md)
- [APIテストガイド](API_TEST_GUIDE.md)
- [UI画面の使い方](../README_UI.md)




